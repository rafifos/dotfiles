#!/usr/bin/env bash
# shellcheck disable=SC1009,1036,SC1054,SC1056,SC1072,SC1073,SC1083

# Installs Davmail. The POP/IMAP/SMTP/Caldav/Carddav/LDAP Exchange and Office
# 365 Gateway.

{{- template "work" . -}}
{{- template "shellscript" -}}

readonly properties_file="${HOME}/.davmail.properties"

flatpak remote-add --if-not-exists flathub https://dl.flathub.org/repo/flathub.flatpakrepo
flatpak install --user --assumeyes org.davmail.DavMail

tee "$properties_file" &>/dev/null <<'EOF'
davmail.allowRemote=false
davmail.bindAddress=
davmail.caldavAlarmSound=
davmail.caldavAutoSchedule=true
davmail.caldavEditNotifications=false
davmail.caldavPastDelay=0
davmail.caldavPort=1080
davmail.carddavReadPhoto=true
davmail.clientSoTimeout=
davmail.defaultDomain=
davmail.disableGuiNotifications=false
davmail.disableTrayActivitySwitch=false
davmail.disableUpdateCheck=false
davmail.enableKeepAlive=false
davmail.enableKerberos=false
davmail.enableProxy=false
davmail.folderSizeLimit=
davmail.forceActiveSyncUpdate=false
davmail.imapAlwaysApproxMsgSize=false
davmail.imapAutoExpunge=true
davmail.imapIdleDelay=
davmail.imapPort=1143
davmail.keepDelay=30
davmail.ldapPort=1389
davmail.logFilePath=
davmail.logFileSize=
davmail.mode=EWS
davmail.noProxyFor=
davmail.oauth.clientId=
davmail.oauth.redirectUri=
davmail.oauth.tenantId=
davmail.popMarkReadOnRetr=false
davmail.popPort=1110
davmail.proxyHost=
davmail.proxyPassword=
davmail.proxyPort=
davmail.proxyUser=
davmail.sentKeepDelay=0
davmail.server.certificate.hash=
davmail.server=false
davmail.showStartupBanner=true
davmail.smtpPort=1025
davmail.smtpSaveInSent=true
davmail.ssl.clientKeystoreFile=
davmail.ssl.clientKeystorePass=
davmail.ssl.clientKeystoreType=
davmail.ssl.keyPass=
davmail.ssl.keystoreFile=
davmail.ssl.keystorePass=
davmail.ssl.keystoreType=
davmail.ssl.nosecurecaldav=false
davmail.ssl.nosecureimap=false
davmail.ssl.nosecureldap=false
davmail.ssl.nosecurepop=false
davmail.ssl.nosecuresmtp=false
davmail.ssl.pkcs11Config=
davmail.ssl.pkcs11Library=
davmail.url=https://exchange2-2016.aec.com.br/owa/
davmail.useSystemProxies=true
log4j.logger.davmail=DEBUG
log4j.logger.httpclient.wire=WARN
log4j.logger.httpclient=WARN
log4j.logger.org.apache.http.conn.ssl=WARN
log4j.logger.org.apache.http.wire=WARN
log4j.logger.org.apache.http=WARN
log4j.rootLogger=WARN
EOF
