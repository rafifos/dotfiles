#!/usr/bin/env bash
# shellcheck disable=SC2155,SC1090
#
# References:
# - https://github.com/arcticicestudio/igloo/blob/ac9f7bf7a3e931ff4825757a428e9c00fbb45543/snowblocks/bash/bootstrap
# - https://misc.flogisoft.com/bash/tip_colors_and_formatting
#
export BOOTSTRAP_BASE_DIR="$(pwd)"

__bootstrap::log_info() {
  printf "\e[34m[INFO]\e[0m %s\n" "$*"
}

__bootstrap::log_warn() {
  printf "\e[33m[WARN]\e[0m %s\n" "$*"
}

__bootstrap::log_error() {
  printf "\e[31m[ERROR]\e[0m %s\n" "$*" 1>&2
}

__bootstrap::load_core_module() {
  local module
  
  if [ "$#" -eq 0 ]; then
    # shellcheck disable=SC2128
    __bootstrap::log_info "Missing parameter while calling function $FUNCNAME"
    __bootstrap::log_error "Error while loading core modules"
    return 1
  fi

  # shellcheck disable=SC2048
  for module in $*; do
    module="$BOOTSTRAP_BASE_DIR/$module.sh"

    if [[ -f "$module" ]]; then
      if source "$module"; then
        __bootstrap::log_info "Core module $(basename "$module") successfully loaded"
      else
        __bootstrap::log_info "Error while loading core module $(basename "$module")"
      fi
    else
      __bootstrap::log_error "Core module $(basename "$module") not found"
      return 1
    fi
  done
}

# +--------------+
# + Core Modules +
# +--------------+
__bootstrap::load_core_module core/utils core/homemaker core/apt core/flatpak

if [[ ! -x "$(pwd)/homemaker" ]]; then
  __homemaker::install
fi
