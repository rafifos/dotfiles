- defaults:
    shell:
      stdout: false

- sudo:
    - shell:
        - command: curl -sS https://downloads.1password.com/linux/keys/1password.asc | gpg --dearmor --yes --output /usr/share/keyrings/1password-archive-keyring.gpg
          description: "[1password] Import archive keyring"

    - shell:
        - command: echo 'deb [arch=amd64 signed-by=/usr/share/keyrings/1password-archive-keyring.gpg] https://downloads.1password.com/linux/debian/amd64 stable main' | tee /etc/apt/sources.list.d/1password.list
          description: "[1password] Add apt repository"

    - shell:
        - command: mkdir -p /etc/debsig/policies/AC2D62742012EA22
          description: "[1password] Import debsig-verify policy (1/4)"

    - shell:
        - command: curl -sS https://downloads.1password.com/linux/debian/debsig/1password.pol | tee /etc/debsig/policies/AC2D62742012EA22/1password.pol
          description: "[1password] Import debsig-verify policy (2/4)"

    - shell:
        - command: mkdir -p /usr/share/debsig/keyrings/AC2D62742012EA22
          description: "[1password] Import debsig-verify policy (3/4)"

    - shell:
        - command: curl -sS https://downloads.1password.com/linux/keys/1password.asc | gpg --dearmor --yes --output /usr/share/debsig/keyrings/AC2D62742012EA22/debsig.gpg
          description: "[1password] Import debsig-verify policy (4/4)"

    - aptget: [1password, 1password-cli]
